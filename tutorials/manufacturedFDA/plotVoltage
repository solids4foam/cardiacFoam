#!/bin/bash

# Usage:
#   ./plot.sh        -> plots the latest txt file
#   ./plot.sh all    -> plots all txt files

if [ "$1" == "all" ]; then
    files=$(ls -t *.txt 2>/dev/null)
    if [ -z "$files" ]; then
        echo "No .txt files found in $(pwd)."
        exit 1
    fi
    echo "Plotting all txt files..."
    gnuplot -persist <<EOF
set title "Voltage Plot: All Files"
set xlabel "Time"
set ylabel "Voltage (mV)"
plot for [f in system('ls -t *.txt')] f using 1:2 with lines title f
EOF
else
    # Default: plot the most recent txt file
    latest=$(ls -t *.txt 2>/dev/null | head -n 1)
    if [ -z "$latest" ]; then
        echo "No .txt files found in $(pwd)."
        exit 1
    fi
    echo "Plotting $latest ..."
    gnuplot -persist <<EOF
set title "Voltage Plot: $latest"
set xlabel "Time"
set ylabel "Voltage (mV)"
plot "$latest" using 1:2 with lines title "Vm"
EOF
fi
